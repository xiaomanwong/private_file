---
title: 建造者模式
tag: 设计模式
categories: 设计模式 
---



![image-20211119173717815](https://i.loli.net/2021/11/19/8iXdcJoVFHWSR5r.png)



Builder 模式，中文翻译为 **建造者模式**



* 当存在必填项，或者必填项的配置有很多，把这些必填配置都放到构造函数中设置，那构造函数就会出现参数列表很长的问题。如果把这些必填项通过 set() 方法设置，那校验这些必填项是否 已经填写的逻辑无处安放。
* 假设配置项之间有一定的依赖关系，或者配置项之间有一定的约束关系。同样存在配置项之间的逻辑校验无处安放。
* 如果希望类对象是不可变对象，也就是说，对象在创建好之后，就不能再修改内部的属性值。

```java
public class ResourcePoolConfig{
  private String name;
  private int maxTotal;
  private int maxIdle;
  private int minIdle;
  
  private ResourcePoolConfig(Builder builder) {
    this.name = builder.name;
    this.maxToal = builder.maxTotal;
    this.maxIdle = builder.maxIdle;
    this.minIdle = builder.minIdle;
  }
  
  
  // 我们将 builder 类设计成内部类
  // 也可以将 Builder 类设计成独立的内部类
  public static class Builder {
    private static final int DEFAULT_MAX_TOTAL = 8;
    private static final int DEFAULT_MAX_IDLE = 8;
    private static final int DEFAULT_MIN_IDLE = 0;
    
    private String name;
    private int maxTotal = DEFAULT_MAX_TATAL;
    private int maxIdle = DEFAULT_MAX_IDLE;
    private int minIdle = DEFAULT_MIN_IDLE;
    
    public ResourcePoolConfig build(){
      // 逻辑校验放在这里做，包括必填项校验，依赖关系校验，约束条件校验
      if(TextUtils.isEmpty(name)) {
        throw new IllegalArgumentException("....");
      }
      
      if(maxIdle > maxTotal) {
        throw new IllegalArgumentException("....");
      }
      
      if(minIdle > maxTotal || minIdle > maxIdle) {
        throw new IllegalArgumentException("....");
      }
      
      return new ResourcePoolConfig(this);
    }
    
    public Builder setName(String name) {
      this.name = name;
      return this;
    }
    
    public Builder setMaxTotal(int maxTotal) {
      this.maxTotal = maxTotal;
      return this;
    }
    
    public Builder setMaxIdle(int maxIdle) {
      this.maxIdle = maxIdle;
      return this;
    }
    
    public Builder setMinIdle(int minIdle) {
      this.minIdle = minIdle;
      return this;
    }
  }
}



// 使用
ResourcePoolConfig config = new ResourcePoolConfig.Builder()
  .setName("connectionPool")
  .setMaxTotal(16)
  .setMaxIdle(10)
  .setMinIdle(12)
  .build();
```

**与工厂模式的区别**

二者都是负责对象的创建工作，但实际上，工厂模式是用来创建不同但是相关类型的对象（继承同一父类或者接口），由给定的参数来决定创建哪种类型的对象。建造者模式是用来创建一种类型复杂的对象，通过设置不同的可选参数，“定制化”地创建不同的对象。



举个栗子：顾客⾛进⼀家餐馆点餐，我们利⽤⼯⼚模式，根据⽤⼾不同的选择，来制作不同的⻝物，⽐如披萨、汉堡、沙拉。对于披萨来说，⽤⼾⼜有各种配料可以定制，⽐如奶酪、西红柿、起司，我们通过建造者模式根据⽤⼾选择的不同配料来制作披萨。



**只有了解了最本质的东西，我们才能不生搬硬套，才能灵活应用，甚至可以混用各种模式创造出新的模式，来解决特定场景的问题。**