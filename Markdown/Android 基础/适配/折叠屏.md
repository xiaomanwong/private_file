# 折叠屏

[toc]
## 背景

**折叠形态**
* 展开态：完全展开后的形态；尺寸更大，可充分显示应用内容
* 折叠态：折叠后形态；屏幕尺寸变小
* 支架态：完全展开与折叠的中间态，可平稳放置

![Img](https://developer.android.com/static/images/guide/topics/large-screens/foldables/foldable_multiple_postures.png?hl=zh-cn)

**基于宽度**
| Compact | Medium | Expanded |
| -- | -- | -- |
| 小于 600dp | 600~840dp | 840dp~ |
|紧凑型|中等型|展开型|

![Img](https://developer.android.com/static/images/guide/topics/large-screens/foldables/fold-unfold.gif?hl=zh-cn)
![Img](https://image.ajunews.com/content/image/2021/11/10/20211110112837614888.jpg)
![Img](https://qnam.smzdm.com/202110/12/61658f6dd702c244.png_e1080.jpg)
![Img](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/4/28/16a6350fbb1fb3f3~tplv-t2oaga2asx-zoom-crop-mark:3024:3024:3024:1702.awebp)
![Img](https://img.cnmo.com/1661_600x1000/1660011.jpg)
## 适配目标
**思路：** 构建响应式和自适应界面，调整内容以适应所有情况。

**目标：**

* 确保应用界面能够在各类屏幕上美观的呈现
* 提高应用活跃度，用户增长。
* 应用连续性
* 屏幕兼容性
* 多窗口支持与任意比例(Android 12 及以上 (L))
* 厂商适配（三星、华为、OPPO、小米 .etc）

### 长期规划
引入 `Jetpack Compose` 作为可折叠设备适配方案，[Jetpack Compose 实现完美屏幕适配](https://juejin.cn/post/7113953940282015758)
未来，设计时，需要提供可折叠设备设计稿

**成本：新技术需要全员学习，并实践！**


### 短期规划
::: tip 参考数据
以下数据均以基于 Korea 1.1 版本统计，提供的数据，仅供参考
Activity: 210 个
Fragment: 248 个
layout xml: 1200 个
:::

**设计、产品侧：**
为增强用户体验，页面观感，设计和产品同学：
1. 应针对存量 UI，重新设计；并给出设计规范；
2. APP 整体针对可折叠设备的风格，需确认。

参考文献：
1. [商业化产品折叠屏设计案例](https://cloud.tencent.com/developer/article/1969594){link-type="luckysheet"}
2. [折叠屏 | 又双叒叕成功适配！折叠屏＋携程，旅行体验提高不止一个Level！](https://cloud.tencent.com/developer/article/1969638)

**技术侧：**
1. 以资源限定符及多窗口模式，处理全部存量代码；对 Activity，Fragment 在可折叠设备上进行重构。
2. 处理应用连续性；需对所有页面判断是否需要重建或连续，以完成在折叠状态变化时，布局文件切换。
3. 筛选 xml 布局文件，对尺寸硬编码页面进行自适应修复。
4. 提高产品特性，个别页面，需设计重新针对可折叠设备设计，重新研发。
5. 厂商适配

粗略工时，需要全员人力（8 人），25 天完成，详细时间视设计稿**交付时间**及**复杂度**决定。

## 应用适配办法
### 应用连续性
´
**处理配置变更**
```xml
<activity android:configChanges="smallestScreenSize|screenSize|screenLayout" />
```
应用内监听变化，根据当前窗口大小，调整布局大小和位置
```kotlin
override fun onConfigurationChanged(newConfig: Configuration) {
		// 获取当前窗口配置信息，调整布局大小
}
```
如果需要重启 Activity才能完成适配的场景，可以通过onSaveInstanceState()与onRestoreInstanceState() 或 ViewModel对象来进行之前状态保存和后续的恢复。

### 屏幕兼容性
需针对页面进行重新设计，具备多尺寸能力。
* 资源限定布局，如：
```
layout-sw600dp-v13
```
折叠时，如需动态改变尺寸，在 `manifest` 中的 `Application` 或对应的 `Activity` 生命如下属性：

[支持不同的屏幕尺寸](https://developer.android.google.cn/training/multiscreen/screensizes)

```
resizeableActivity=false
```

**注意：**如果设置了 `resizeableActivity=false`,则会告知平台不支持多窗口模式。系统可能仍会调整应用的大小或置于多窗口模式；此时需要支持折叠连续性（不重启 Activity)，添加属性：
```xml
<meta-data
    android:name="android.supports_size_changes" android:value="true" />
```
* 灵活布局
1. 使用 `wrap_content`,`match_parent` 避免硬编码
1. 使用 `ConstraintLayout` 做根布局，方便屏幕尺寸变化，视图紫铜移动和拉抻


### 厂商适配
折叠屏厂商发布了对应适配文档的主要有：三星、华为、微软等。


1. 三星折叠屏适配
主要参考三星折叠屏适配指导，基本同Android官方适配指南相差不大，部分需要独立适配的，只需针对三星屏幕信息进行适配即可。如折叠后纵横比 21 : 9，展开纵横比：4.2 : 3等。
[三星 fold 适配指南](http://support-cn.samsung.com/Upload/DeveloperChina/DeveloperChinaFile/20190328105138651FCCB39045C.pdf)

2. 微软Surface Duo双屏适配
在Android 官方适配指南的基础上，可再参考Surface官方：Surface Duo 开发人员文档 进行完全适配。Surfce不仅提供了其独有的Surface 双屏布局库独有功能，还有部分适用于 Surface Duo 的 Android 示例应用。


3. 华为折叠屏适配官方文档
华为折叠屏应用开发指导 包括提供给UX同学的设计指引，以及RD同学的接入指南。以下会重点介绍下其独有的华为应用内分屏：平行视界功能


## 需要引入 Library

`Jetpact WindowManager `
1. 所有折叠设备提供统一 API，避免各设备单独适配。
1. 可折叠设备物理属性：**折叠屏类型、折叠状态、铰链方向、窗口显示范围**等信息

## 工具

#### Android Studio 
> Android Studio Chipmunk 以上
* Layout Validation 会显示布局文件在不同设备上的警告信息，可预览。
* Androidx.window
* SlidingPaneLayout 双窗格布局
* Resizable Emulator 可调整尺寸的模拟器



## 参考文献
[折叠屏适配](https://blog.csdn.net/h4x0r_007/article/details/122325680)
[华为折叠屏适配方案](https://developer.huawei.com/consumer/cn/doc/development/other/responsive_layout-0000001249470186)
[Demo](https://github.com/android/user-interface-samples/blob/master/WindowManager/app/src/main/res/layout/activity_display_features.xml#L57)
[JetNews 视频](https://www.youtube.com/watch?v=ir3LztqbeRI)
[JetNews Simple](https://github.com/devmike01/JetNews-Extended.git)
[搜索->折叠屏开发指导系列](https://cloud.tencent.com/developer/column/94920)
[掘金折叠屏适配-1](https://juejin.cn/post/7049705037525680164)
[掘金折叠屏适配-2](https://juejin.cn/post/6844903889267867656)
[掘金折叠屏适配-3](https://juejin.cn/post/6844903853503021064)